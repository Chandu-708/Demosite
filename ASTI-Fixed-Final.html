<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ASTI - Complaint Management System</title>
    <style>
        * { margin:0; padding:0; box-sizing:border-box; }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #1a1a2e 0%, #16213e 100%);
            min-height: 100vh;
            overflow-x: hidden;
        }

        .bg-logo {
            position: fixed; top: 50%; left: 50%;
            transform: translate(-50%, -50%);
            opacity: 0.06; width: 600px;
            z-index: 0; pointer-events: none;
        }

        .container {
            max-width: 1200px; margin: 0 auto;
            padding: 20px; position: relative; z-index: 1;
        }

        /* â”€â”€ HEADER â”€â”€ */
        header {
            background: rgba(255,255,255,0.05);
            backdrop-filter: blur(10px);
            border-radius: 15px; padding: 30px;
            margin-bottom: 30px; text-align: center;
            border: 1px solid rgba(255,255,255,0.1);
            box-shadow: 0 8px 32px rgba(0,0,0,0.3);
            position: relative;
        }
        .user-bar {
            position: absolute; top: 18px; right: 18px;
            display: flex; align-items: center; gap: 12px;
        }
        .welcome-text { color: #ff6b81; font-weight: 600; font-size: 0.95em; }
        .logo-img { width: 110px; margin-bottom: 12px; }
        h1 { color: #fff; font-size: 2.2em; margin-bottom: 6px; }
        .sub { color: #b8b8d1; font-size: 1.1em; }
        .tag { color: #9191b8; font-size: 0.88em; font-style: italic; }

        /* â”€â”€ BUTTONS â”€â”€ */
        .btn {
            display: inline-block; width: 100%;
            padding: 13px 20px;
            background: linear-gradient(135deg, #ff6b81, #ff8fa3);
            color: #fff; border: none; border-radius: 8px;
            font-size: 1.05em; font-weight: 700; cursor: pointer;
            text-transform: uppercase; letter-spacing: 1px;
            transition: all 0.25s ease;
        }
        .btn:hover { transform: translateY(-2px); box-shadow: 0 8px 20px rgba(255,107,129,0.45); }
        .btn:active { transform: translateY(0); box-shadow: none; }

        .btn-sm {
            width: auto; padding: 8px 20px;
            background: rgba(255,107,129,0.15);
            color: #ff6b81; border: 1.5px solid #ff6b81;
            border-radius: 20px; font-size: 0.9em;
            text-transform: none; letter-spacing: 0; font-weight: 600;
            cursor: pointer; transition: all 0.2s;
        }
        .btn-sm:hover { background: #ff6b81; color: #fff; box-shadow: none; transform: none; }

        .btn-filter {
            width: auto; padding: 7px 16px;
            background: rgba(255,255,255,0.08);
            border: 1.5px solid rgba(255,255,255,0.2);
            color: #b8b8d1; border-radius: 20px;
            font-size: 0.82em; font-weight: 600;
            text-transform: none; letter-spacing: 0;
            cursor: pointer; transition: all 0.2s;
        }
        .btn-filter:hover, .btn-filter.active {
            background: rgba(255,107,129,0.18);
            border-color: #ff6b81; color: #ff6b81;
            transform: translateY(-1px); box-shadow: none;
        }

        /* â”€â”€ AUTH CARD â”€â”€ */
        .auth-wrap {
            display: flex; justify-content: center; align-items: center;
            min-height: calc(100vh - 220px);
        }
        .auth-card {
            background: rgba(255,255,255,0.08);
            backdrop-filter: blur(10px);
            border-radius: 15px; padding: 38px;
            border: 1px solid rgba(255,255,255,0.1);
            box-shadow: 0 8px 32px rgba(0,0,0,0.25);
            width: 100%; max-width: 460px;
        }
        .auth-card h2 { color: #ff6b81; font-size: 1.85em; margin-bottom: 6px; text-align: center; }
        .auth-card .desc { color: #b8b8d1; text-align: center; margin-bottom: 22px; font-size: 0.95em; }

        .notice {
            padding: 11px 14px; border-radius: 8px;
            margin-bottom: 18px; font-size: 0.88em; line-height: 1.55;
        }
        .notice-warn { background: rgba(255,193,7,0.12); border: 1px solid rgba(255,193,7,0.4); color: #ffc107; }
        .notice-info { background: rgba(76,175,80,0.1);  border: 1px solid rgba(76,175,80,0.35); color: #4caf50; }

        .switch-link { text-align: center; margin-top: 16px; color: #b8b8d1; font-size: 0.93em; }
        .switch-link a { color: #ff6b81; font-weight: 600; cursor: pointer; text-decoration: none; }
        .switch-link a:hover { color: #ff8fa3; text-decoration: underline; }

        /* â”€â”€ REMEMBER ME â”€â”€ */
        .remember-row {
            display: flex; justify-content: space-between;
            align-items: center; margin: 6px 0 18px; flex-wrap: wrap; gap: 6px;
        }
        .remember-label {
            display: flex; align-items: center; gap: 8px;
            color: #b8b8d1; font-size: 0.92em;
            cursor: pointer; user-select: none;
        }
        .remember-label input[type="checkbox"] {
            width: 16px !important; height: 16px !important;
            accent-color: #ff6b81;
            cursor: pointer; flex-shrink: 0;
            padding: 0 !important;
            background: none !important;
        }
        .remember-hint { color: #9191b8; font-size: 0.8em; }

        /* â”€â”€ PASSWORD SHOW / HIDE â”€â”€ */
        .pass-wrap { position: relative; }
        .pass-wrap input { padding-right: 46px; }
        .eye-btn {
            position: absolute; right: 11px; top: 50%;
            transform: translateY(-50%);
            background: none; border: none; width: auto;
            cursor: pointer; padding: 4px 6px;
            font-size: 1.1em; line-height: 1;
            color: #9191b8; transition: color 0.2s;
            text-transform: none; letter-spacing: 0;
        }
        .eye-btn:hover { color: #ff6b81; transform: translateY(-50%); box-shadow: none; }

        /* â”€â”€ FORMS â”€â”€ */
        .form-group { margin-bottom: 16px; }
        label { display: block; color: #b8b8d1; margin-bottom: 6px; font-size: 0.93em; font-weight: 500; }

        input, select, textarea {
            width: 100%; padding: 11px 13px;
            background: rgba(255,255,255,0.1);
            border: 1.5px solid rgba(255,255,255,0.2);
            border-radius: 8px; color: #fff; font-size: 0.98em;
            font-family: inherit; transition: border 0.2s, box-shadow 0.2s;
        }
        input::placeholder, textarea::placeholder { color: rgba(255,255,255,0.38); }
        input:focus, select:focus, textarea:focus {
            outline: none; border-color: #ff6b81;
            box-shadow: 0 0 10px rgba(255,107,129,0.3);
            background: rgba(255,255,255,0.14);
        }
        select option { background: #1a1a2e; color: #fff; }
        textarea { resize: vertical; min-height: 110px; }

        .err-field {
            border-color: #f44336 !important;
            box-shadow: 0 0 8px rgba(244,67,54,0.35) !important;
        }

        .msg {
            padding: 12px 15px; border-radius: 8px;
            font-size: 0.93em; margin-bottom: 15px;
            display: none; line-height: 1.5; word-break: break-word;
        }
        .msg-error   { background: rgba(244,67,54,0.14); border: 1px solid #f44336; color: #f44336; }
        .msg-success { background: rgba(76,175,80,0.14);  border: 1px solid #4caf50; color: #4caf50; }

        /* â”€â”€ SAVE PASSWORD TOAST â”€â”€ */
        .save-toast {
            position: fixed; bottom: -200px; left: 50%;
            transform: translateX(-50%);
            background: linear-gradient(135deg, #1e1e3a 0%, #252545 100%);
            border: 1px solid rgba(255,107,129,0.4);
            border-radius: 16px; padding: 18px 44px 18px 18px;
            box-shadow: 0 10px 40px rgba(0,0,0,0.6);
            z-index: 9999;
            width: 92%; max-width: 430px;
            transition: bottom 0.5s cubic-bezier(0.34, 1.56, 0.64, 1);
            display: flex; align-items: flex-start; gap: 14px;
        }
        .save-toast.show { bottom: 24px; }
        .toast-icon { font-size: 1.7em; flex-shrink: 0; margin-top: 1px; }
        .toast-body { flex: 1; min-width: 0; }
        .toast-title { color: #fff; font-weight: 700; font-size: 0.98em; margin-bottom: 5px; }
        .toast-text  { color: #b8b8d1; font-size: 0.83em; line-height: 1.5; }
        .toast-actions { display: flex; gap: 8px; margin-top: 13px; flex-wrap: wrap; }
        .t-btn-ok {
            padding: 7px 18px; border-radius: 20px;
            background: linear-gradient(135deg, #ff6b81, #ff8fa3);
            color: #fff; border: none; font-size: 0.82em;
            font-weight: 700; cursor: pointer;
            transition: opacity 0.2s; white-space: nowrap;
        }
        .t-btn-ok:hover { opacity: 0.85; }
        .t-btn-skip {
            padding: 7px 14px; border-radius: 20px;
            background: transparent; color: #9191b8;
            border: 1px solid rgba(255,255,255,0.18);
            font-size: 0.82em; cursor: pointer; white-space: nowrap;
            transition: color 0.2s, border-color 0.2s;
        }
        .t-btn-skip:hover { color: #ff6b81; border-color: rgba(255,107,129,0.5); }
        .toast-x {
            position: absolute; top: 10px; right: 12px;
            background: none; border: none; color: #9191b8;
            font-size: 1.1em; cursor: pointer; padding: 4px 6px;
            width: auto; line-height: 1;
            text-transform: none; letter-spacing: 0; font-weight: 400;
        }
        .toast-x:hover { color: #ff6b81; }

        /* â”€â”€ DASHBOARD â”€â”€ */
        .section-box {
            background: rgba(255,255,255,0.05);
            backdrop-filter: blur(8px);
            border-radius: 14px; padding: 24px;
            border: 1px solid rgba(255,255,255,0.1);
            margin-bottom: 26px;
        }
        .section-box h3 { color: #ff6b81; margin-bottom: 14px; font-size: 1.2em; }
        .section-box ul { list-style: none; color: #b8b8d1; }
        .section-box li { padding: 8px 0; border-bottom: 1px solid rgba(255,255,255,0.07); font-size: 0.94em; }
        .section-box li:last-child { border-bottom: none; }
        .section-box li::before { content: "â–¸ "; color: #ff6b81; font-weight: bold; }

        .two-col {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 22px; margin-bottom: 26px;
        }
        .card {
            background: rgba(255,255,255,0.08);
            backdrop-filter: blur(8px);
            border-radius: 14px; padding: 26px;
            border: 1px solid rgba(255,255,255,0.1);
            box-shadow: 0 6px 28px rgba(0,0,0,0.18);
        }
        .card h2 { color: #ff6b81; font-size: 1.5em; margin-bottom: 18px; }
        .card-track { background: rgba(107,91,149,0.1); }

        .complaint-item {
            background: rgba(255,255,255,0.05);
            border-left: 4px solid #ff6b81;
            border-radius: 8px; padding: 13px;
            margin-bottom: 12px;
        }
        .complaint-item h4 { color: #ff6b81; font-size: 0.95em; margin-bottom: 6px; }
        .complaint-item p  { color: #b8b8d1; font-size: 0.88em; margin-bottom: 3px; }

        .badge {
            display: inline-block; padding: 4px 11px;
            border-radius: 20px; font-size: 0.8em; font-weight: 700; margin-top: 6px;
        }
        .b-pending  { background: rgba(255,193,7,0.18);  color: #ffc107; }
        .b-progress { background: rgba(33,150,243,0.18); color: #2196f3; }
        .b-resolved { background: rgba(76,175,80,0.18);  color: #4caf50; }

        .track-result {
            display: none; margin-top: 20px;
            background: rgba(0,0,0,0.2);
            border: 1px solid rgba(255,255,255,0.1);
            border-radius: 10px; padding: 18px;
        }
        .track-result h4 { color: #ff6b81; margin-bottom: 12px; font-size: 1.05em; }
        .track-result p  { color: #b8b8d1; font-size: 0.91em; margin-bottom: 6px; }
        .track-result p strong { color: #fff; }
        .track-desc {
            margin-top: 10px; padding: 10px;
            background: rgba(255,255,255,0.05); border-radius: 7px;
            color: #b8b8d1; font-size: 0.9em; line-height: 1.6;
            white-space: pre-wrap; word-break: break-word;
        }

        .stats-grid { display: flex; gap: 12px; flex-wrap: wrap; margin-bottom: 20px; }
        .stat {
            flex: 1; min-width: 85px;
            background: rgba(255,255,255,0.06);
            border: 1px solid rgba(255,255,255,0.08);
            border-radius: 10px; padding: 14px; text-align: center;
        }
        .stat-n { display: block; font-size: 1.85em; font-weight: 700; color: #ff6b81; }
        .stat-l { display: block; font-size: 0.77em; color: #9191b8; margin-top: 3px; }
        .stat.s-pend .stat-n { color: #ffc107; }
        .stat.s-prog .stat-n { color: #2196f3; }
        .stat.s-resv .stat-n { color: #4caf50; }

        .filter-row { display: flex; gap: 8px; flex-wrap: wrap; margin-bottom: 16px; }

        .tbl-wrap { overflow-x: auto; border-radius: 10px; }
        table { width: 100%; border-collapse: collapse; font-size: 0.89em; }
        thead th {
            background: rgba(255,107,129,0.14); color: #ff6b81;
            padding: 11px 13px; text-align: left; white-space: nowrap;
        }
        tbody tr { border-bottom: 1px solid rgba(255,255,255,0.05); }
        tbody tr:hover { background: rgba(255,255,255,0.03); }
        tbody td { padding: 11px 13px; color: #b8b8d1; vertical-align: middle; }
        .tid { font-family: monospace; color: #fff; font-weight: 600; }
        .timeline { display: flex; align-items: center; gap: 5px; flex-wrap: wrap; }
        .arr { color: #9191b8; font-size: 0.8em; }
        .empty-msg { text-align: center; padding: 32px; color: #9191b8; font-size: 0.95em; }

        a.cl { color: #ff6b81; text-decoration: none; }
        a.cl:hover { color: #ff8fa3; text-decoration: underline; }

        footer { text-align: center; color: #9191b8; padding: 20px; font-size: 0.88em; line-height: 1.9; }

        .hidden { display: none !important; }

        @media (max-width: 768px) {
            h1 { font-size: 1.6em; }
            .two-col { grid-template-columns: 1fr; }
            .user-bar { position: static; justify-content: center; margin-bottom: 14px; }
            .auth-card { padding: 26px 16px; }
            .bg-logo { width: 320px; }
            .stats-grid { gap: 8px; }
            .save-toast { width: 95%; padding-right: 40px; }
        }
    </style>
</head>
<body>

<!-- Background watermark logo -->
<svg class="bg-logo" viewBox="0 0 768 690" xmlns="http://www.w3.org/2000/svg">
    <polygon points="384,50 584,250 184,250" fill="#ff6b81" opacity="0.8"/>
    <text x="384" y="340" font-family="Arial" font-size="120" fill="#6b5b95" text-anchor="middle">aurora</text>
    <polygon points="184,420 284,620 84,620" fill="#b8b5d1" opacity="0.8"/>
    <polygon points="584,420 484,620 684,620" fill="#b8b5d1" opacity="0.8"/>
    <text x="384" y="520" font-family="Arial" font-size="40" fill="#6b5b95" text-anchor="middle">TEMPLE</text>
    <text x="384" y="565" font-family="Arial" font-size="40" fill="#6b5b95" text-anchor="middle">OF</text>
    <text x="384" y="610" font-family="Arial" font-size="40" fill="#6b5b95" text-anchor="middle">LEARNING</text>
</svg>

<div class="container">

<!-- HEADER -->
<header>
    <div class="user-bar hidden" id="userBar">
        <span class="welcome-text">Welcome, <span id="userName"></span>!</span>
        <button class="btn btn-sm" onclick="doLogout()">Logout</button>
    </div>
    <svg class="logo-img" viewBox="0 0 768 690" xmlns="http://www.w3.org/2000/svg">
        <polygon points="384,50 584,250 184,250" fill="#ff6b81"/>
        <text x="384" y="340" font-family="Arial" font-size="120" fill="#6b5b95" text-anchor="middle">aurora</text>
        <polygon points="184,420 284,620 84,620" fill="#b8b5d1"/>
        <polygon points="584,420 484,620 684,620" fill="#b8b5d1"/>
        <text x="384" y="520" font-family="Arial" font-size="40" fill="#6b5b95" text-anchor="middle">TEMPLE</text>
        <text x="384" y="565" font-family="Arial" font-size="40" fill="#6b5b95" text-anchor="middle">OF</text>
        <text x="384" y="610" font-family="Arial" font-size="40" fill="#6b5b95" text-anchor="middle">LEARNING</text>
    </svg>
    <h1>Aurora's Scientific and Technological Institute</h1>
    <p class="sub">Complaint Management System</p>
    <p class="tag">Temple of Learning</p>
</header>

<!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
     LOGIN PAGE
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
<div id="pg-login" class="auth-wrap">
    <div class="auth-card">
        <h2>ğŸ” Login</h2>
        <p class="desc">Sign in to access the complaint system</p>
        <div class="notice notice-warn">
            <strong>âš ï¸ First Time?</strong> You must <strong>register</strong> before logging in.
        </div>
        <div class="msg msg-error" id="login-err"></div>

        <div class="form-group">
            <label>Username</label>
            <input type="text" id="l-user" placeholder="Enter your username"
                   autocomplete="username"
                   onkeydown="if(event.key==='Enter') document.getElementById('l-pass').focus()">
        </div>
        <div class="form-group">
            <label>Password</label>
            <div class="pass-wrap">
                <input type="password" id="l-pass"
                       autocomplete="current-password"
                       placeholder="Enter your password"
                       onkeydown="if(event.key==='Enter') doLogin()">
                <button type="button" class="eye-btn"
                        onclick="toggleEye('l-pass','eye-login')"
                        title="Show / hide password">
                    <span id="eye-login">ğŸ‘ï¸</span>
                </button>
            </div>
        </div>

        <div class="remember-row">
            <label class="remember-label">
                <input type="checkbox" id="l-remember">
                Remember me
            </label>
            <span class="remember-hint">Saves credentials on this device</span>
        </div>

        <button class="btn" onclick="doLogin()">Login</button>
        <div class="switch-link">
            Don't have an account? <a onclick="gotoPage('register')">Register here</a>
        </div>
    </div>
</div>

<!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
     REGISTER PAGE
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
<div id="pg-register" class="auth-wrap hidden">
    <div class="auth-card">
        <h2>ğŸ“ Create Account</h2>
        <p class="desc">Fill in all fields below to register</p>
        <div class="notice notice-info">
            <strong>âœ“ New User?</strong> Complete this form, then login to file complaints.
        </div>
        <div class="msg msg-success" id="reg-ok"></div>
        <div class="msg msg-error"   id="reg-err"></div>

        <div class="form-group">
            <label>Username <span style="color:#9191b8;font-size:0.85em;">(min. 4 chars, no spaces)</span></label>
            <input type="text" id="r-user" placeholder="e.g. john_doe" autocomplete="username">
        </div>
        <div class="form-group">
            <label>Full Name</label>
            <input type="text" id="r-name" placeholder="e.g. John Doe" autocomplete="name">
        </div>
        <div class="form-group">
            <label>Email Address</label>
            <input type="text" id="r-email" placeholder="e.g. john@asti.edu.in" autocomplete="email">
        </div>
        <div class="form-group">
            <label>Phone Number</label>
            <input type="text" id="r-phone" placeholder="+91 99999 99999" inputmode="tel" autocomplete="tel">
        </div>
        <div class="form-group">
            <label>Password <span style="color:#9191b8;font-size:0.85em;">(min. 6 chars)</span></label>
            <div class="pass-wrap">
                <input type="password" id="r-pass"
                       autocomplete="new-password"
                       placeholder="Create a strong password">
                <button type="button" class="eye-btn"
                        onclick="toggleEye('r-pass','eye-reg')"
                        title="Show / hide password">
                    <span id="eye-reg">ğŸ‘ï¸</span>
                </button>
            </div>
        </div>
        <div class="form-group">
            <label>Confirm Password</label>
            <div class="pass-wrap">
                <input type="password" id="r-confirm"
                       autocomplete="new-password"
                       placeholder="Re-enter your password"
                       onkeydown="if(event.key==='Enter') doRegister()">
                <button type="button" class="eye-btn"
                        onclick="toggleEye('r-confirm','eye-conf')"
                        title="Show / hide password">
                    <span id="eye-conf">ğŸ‘ï¸</span>
                </button>
            </div>
        </div>

        <button class="btn" onclick="doRegister()">Create Account</button>
        <div class="switch-link">
            Already have an account? <a onclick="gotoPage('login')">Login here</a>
        </div>
    </div>
</div>

<!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
     DASHBOARD PAGE
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
<div id="pg-dash" class="hidden">

    <div class="section-box">
        <h3>ğŸ“‹ How to File a Complaint</h3>
        <ul>
            <li>Fill the complaint form with your accurate personal details</li>
            <li>Select the correct department and complaint category</li>
            <li>Write a clear, detailed description of your issue</li>
            <li>Save your Ticket ID shown after submission to track progress</li>
            <li>Expect a response within 3â€“5 working days</li>
        </ul>
    </div>

    <div class="two-col">
        <!-- Submit Complaint -->
        <div class="card">
            <h2>ğŸ“ Submit Complaint</h2>
            <div class="msg msg-success" id="c-ok"></div>
            <div class="msg msg-error"   id="c-err"></div>
            <div class="form-group">
                <label>Full Name</label>
                <input type="text" id="c-name" placeholder="Your full name" autocomplete="off">
            </div>
            <div class="form-group">
                <label>Email Address</label>
                <input type="text" id="c-email" placeholder="your.email@asti.edu.in" autocomplete="off">
            </div>
            <div class="form-group">
                <label>Roll No. / Employee ID</label>
                <input type="text" id="c-roll" placeholder="Your ID number" autocomplete="off">
            </div>
            <div class="form-group">
                <label>Department</label>
                <select id="c-dept">
                    <option value="">â€” Select Department â€”</option>
                    <option value="cse">Computer Science &amp; Engineering</option>
                    <option value="ece">Electronics &amp; Communication Engg.</option>
                    <option value="eee">Electrical &amp; Electronics Engg.</option>
                    <option value="mech">Mechanical Engineering</option>
                    <option value="civil">Civil Engineering</option>
                    <option value="admin">Administration</option>
                    <option value="library">Library</option>
                    <option value="hostel">Hostel</option>
                    <option value="other">Other</option>
                </select>
            </div>
            <div class="form-group">
                <label>Complaint Category</label>
                <select id="c-cat">
                    <option value="">â€” Select Category â€”</option>
                    <option value="academic">Academic Issues</option>
                    <option value="infrastructure">Infrastructure &amp; Facilities</option>
                    <option value="library">Library Services</option>
                    <option value="hostel">Hostel &amp; Accommodation</option>
                    <option value="transport">Transportation</option>
                    <option value="canteen">Canteen &amp; Food Services</option>
                    <option value="harassment">Harassment / Ragging</option>
                    <option value="admin">Administrative Issues</option>
                    <option value="other">Other</option>
                </select>
            </div>
            <div class="form-group">
                <label>Description <span style="color:#9191b8;font-size:0.85em;">(min. 10 chars)</span></label>
                <textarea id="c-desc" placeholder="Describe your issue clearly..."></textarea>
            </div>
            <button class="btn" onclick="doSubmitComplaint()">Submit Complaint</button>
        </div>

        <!-- Track + Recent -->
        <div class="card card-track">
            <h2>ğŸ” Track Complaint</h2>
            <div class="form-group">
                <label>Ticket ID</label>
                <input type="text" id="t-id" placeholder="e.g. CMP202512345" autocomplete="off"
                       onkeydown="if(event.key==='Enter') doTrack()">
            </div>
            <div class="msg msg-error" id="t-err"></div>
            <button class="btn" onclick="doTrack()">Track Status</button>

            <div class="track-result" id="trackBox">
                <h4>ğŸ“„ Complaint Details</h4>
                <p><strong>Ticket ID:</strong>  <span id="tr-tid"></span></p>
                <p><strong>Status:</strong>     <span id="tr-sts"></span></p>
                <p><strong>Category:</strong>   <span id="tr-cat"></span></p>
                <p><strong>Department:</strong> <span id="tr-dep"></span></p>
                <p><strong>Date Filed:</strong> <span id="tr-dte"></span></p>
                <div class="track-desc" id="tr-dsc"></div>
            </div>

            <div style="margin-top:26px;">
                <h3 style="color:#b8b8d1;font-size:1em;margin-bottom:13px;">ğŸ“Œ Your Recent Complaints</h3>
                <div id="recentList">
                    <div class="empty-msg">No complaints filed yet.</div>
                </div>
            </div>
        </div>
    </div>

    <!-- Status Dashboard -->
    <div class="card" style="margin-bottom:26px;">
        <h2>ğŸ“Š Previous Status Dashboard</h2>
        <div class="stats-grid">
            <div class="stat">
                <span class="stat-n" id="s-total">0</span>
                <span class="stat-l">Total</span>
            </div>
            <div class="stat s-pend">
                <span class="stat-n" id="s-pend">0</span>
                <span class="stat-l">Pending</span>
            </div>
            <div class="stat s-prog">
                <span class="stat-n" id="s-prog">0</span>
                <span class="stat-l">In Progress</span>
            </div>
            <div class="stat s-resv">
                <span class="stat-n" id="s-resv">0</span>
                <span class="stat-l">Resolved</span>
            </div>
        </div>
        <div class="filter-row">
            <button class="btn-filter active" onclick="filterComplaints('all',this)">All</button>
            <button class="btn-filter" onclick="filterComplaints('Pending',this)">ğŸ• Pending</button>
            <button class="btn-filter" onclick="filterComplaints('In Progress',this)">ğŸ”„ In Progress</button>
            <button class="btn-filter" onclick="filterComplaints('Resolved',this)">âœ… Resolved</button>
        </div>
        <div class="tbl-wrap">
            <table>
                <thead>
                    <tr>
                        <th>#</th><th>Ticket ID</th><th>Category</th>
                        <th>Department</th><th>Date</th>
                        <th>Status History</th><th>Status</th>
                    </tr>
                </thead>
                <tbody id="historyBody"></tbody>
            </table>
            <div id="historyEmpty" class="empty-msg hidden">No complaints found for this filter.</div>
        </div>
    </div>

    <!-- Contact -->
    <div class="section-box">
        <h3>ğŸ“ Contact Information</h3>
        <ul>
            <li><strong>Email:</strong> <a href="mailto:complaints@asti.edu.in" class="cl">complaints@asti.edu.in</a></li>
            <li><strong>Phone:</strong> <a href="tel:+914012345678" class="cl">+91 (040) 1234-5678</a></li>
            <li><strong>Office Hours:</strong> Monday â€“ Friday, 9:00 AM â€“ 5:00 PM</li>
            <li><strong>Emergency:</strong> <a href="tel:+919876543210" class="cl">+91 98765 43210</a> (24/7)</li>
        </ul>
    </div>

</div><!-- /pg-dash -->

<!-- SAVE PASSWORD TOAST -->
<div id="saveToast" class="save-toast" role="alert" aria-live="polite">
    <div class="toast-icon">ğŸ”‘</div>
    <div class="toast-body">
        <div class="toast-title">Save your password?</div>
        <div class="toast-text">
            Keep your account secure â€” your credentials have been saved locally
            so you stay logged in on this device.
        </div>
        <div class="toast-actions">
            <button class="t-btn-ok"   onclick="toastAck()">âœ“ Got it</button>
            <button class="t-btn-skip" onclick="toastClose(false)">Not now</button>
            <button class="t-btn-skip" onclick="toastClose(true)">Don't show again</button>
        </div>
    </div>
    <button class="toast-x" onclick="toastClose(false)" title="Close">âœ•</button>
</div>

<footer>
    <p>&copy; 2025 Aurora's Scientific and Technological Institute (ASTI). All rights reserved.</p>
    <p>Temple of Learning â€” Empowering minds, Building futures</p>
</footer>

</div><!-- /container -->

<script>
/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   GLOBAL STATE
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
var CURRENT_USER   = null;
var ALL_COMPLAINTS = [];
/* Flag: toast already shown this session so it doesn't re-fire on same login */
var TOAST_SHOWN_THIS_SESSION = false;

var DEPT_MAP = {
    cse:'CSE', ece:'ECE', eee:'EEE',
    mech:'Mechanical Engineering', civil:'Civil Engineering',
    admin:'Administration', library:'Library',
    hostel:'Hostel', other:'Other'
};
var CAT_MAP = {
    academic:'Academic Issues',
    infrastructure:'Infrastructure & Facilities',
    library:'Library Services',
    hostel:'Hostel & Accommodation',
    transport:'Transportation',
    canteen:'Canteen & Food Services',
    harassment:'Harassment / Ragging',
    admin:'Administrative Issues',
    other:'Other'
};

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   UTILITIES
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
function esc(s) {
    return String(s == null ? '' : s)
        .replace(/&/g,'&amp;').replace(/</g,'&lt;')
        .replace(/>/g,'&gt;').replace(/"/g,'&quot;').replace(/'/g,'&#39;');
}

function showErr(id, msg) {
    var el = document.getElementById(id);
    if (!el) return;
    el.textContent = msg;
    el.style.display = 'block';
    setTimeout(function() { if (el) el.style.display = 'none'; }, 8000);
}

function showOk(id, msg) {
    var el = document.getElementById(id);
    if (!el) return;
    el.textContent = msg;
    el.style.display = 'block';
    setTimeout(function() { if (el) el.style.display = 'none'; }, 10000);
}

function hideMsg(id) {
    var el = document.getElementById(id);
    if (el) el.style.display = 'none';
}

function markErr(id) {
    var el = document.getElementById(id);
    if (!el) return;
    el.classList.add('err-field');
    if (el.tagName === 'SELECT') {
        el.scrollIntoView({ behavior: 'smooth', block: 'nearest' });
    } else {
        el.focus();
    }
}

function clearErrors() {
    var els = document.querySelectorAll('.err-field');
    for (var i = 0; i < els.length; i++) els[i].classList.remove('err-field');
}

function badgeClass(status) {
    if (status === 'Resolved')    return 'badge b-resolved';
    if (status === 'In Progress') return 'badge b-progress';
    return 'badge b-pending';
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   LOCAL STORAGE â€” safe wrappers
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
function getUsers()          { try { return JSON.parse(localStorage.getItem('asti_users')      || '[]');   } catch(e) { return []; } }
function setUsers(a)         { try { localStorage.setItem('asti_users',      JSON.stringify(a)); } catch(e) {} }
function getComplaints()     { try { return JSON.parse(localStorage.getItem('asti_complaints') || '[]');   } catch(e) { return []; } }
function setComplaints(a)    { try { localStorage.setItem('asti_complaints', JSON.stringify(a)); } catch(e) {} }
function getSession()        { try { return JSON.parse(localStorage.getItem('asti_session')    || 'null'); } catch(e) { return null; } }
function setSession(u)       { try { localStorage.setItem('asti_session',    JSON.stringify(u)); } catch(e) {} }
function clearSession()      { try { localStorage.removeItem('asti_session');                   } catch(e) {} }
function getRemembered()     { try { return localStorage.getItem('asti_remember') || '';         } catch(e) { return ''; } }
function setRemembered(u)    { try { localStorage.setItem('asti_remember', u);                   } catch(e) {} }
function clearRemembered()   { try { localStorage.removeItem('asti_remember');                   } catch(e) {} }
function getSavedPassword()  { try { return localStorage.getItem('asti_saved_pass') || '';       } catch(e) { return ''; } }
function setSavedPassword(p) { try { localStorage.setItem('asti_saved_pass', p);                 } catch(e) {} }
function clearSavedPassword(){ try { localStorage.removeItem('asti_saved_pass');                 } catch(e) {} }
function getNoToast()        { try { return localStorage.getItem('asti_no_toast') === '1';        } catch(e) { return false; } }
function setNoToast()        { try { localStorage.setItem('asti_no_toast', '1');                  } catch(e) {} }

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   SHOW / HIDE PASSWORD â€” eye toggle
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
function toggleEye(inputId, iconId) {
    var inp  = document.getElementById(inputId);
    var icon = document.getElementById(iconId);
    if (!inp) return;
    if (inp.type === 'password') {
        inp.type = 'text';
        if (icon) icon.textContent = 'ğŸ™ˆ';
    } else {
        inp.type = 'password';
        if (icon) icon.textContent = 'ğŸ‘ï¸';
    }
    inp.focus();
}

function resetEye(iconId) {
    var icon = document.getElementById(iconId);
    if (icon) icon.textContent = 'ğŸ‘ï¸';
}

function resetPassField(inputId, iconId) {
    var inp = document.getElementById(inputId);
    if (inp) inp.type = 'password';
    resetEye(iconId);
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   SAVE PASSWORD TOAST
   BUG FIX: Only show once per session; "Got it" actually
   saves credentials to localStorage.
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
function showSaveToast() {
    /* Don't show if user permanently dismissed, or already shown this session */
    if (getNoToast() || TOAST_SHOWN_THIS_SESSION) return;
    TOAST_SHOWN_THIS_SESSION = true;
    setTimeout(function() {
        var t = document.getElementById('saveToast');
        if (t) t.classList.add('show');
        /* Auto-hide after 12 seconds if user ignores it */
        setTimeout(function() { toastClose(false); }, 12000);
    }, 1400);
}

function toastAck() {
    /* Actually save the credentials for the current user */
    if (CURRENT_USER && CURRENT_USER.password) {
        setSavedPassword(CURRENT_USER.password);
        setRemembered(CURRENT_USER.username);
        /* Update remember-me checkbox state */
        var cb = document.getElementById('l-remember');
        if (cb) cb.checked = true;
    }
    setNoToast();
    toastClose(false);
}

function toastClose(permanent) {
    if (permanent) setNoToast();
    var t = document.getElementById('saveToast');
    if (t) t.classList.remove('show');
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   PAGE NAVIGATION
   BUG FIX: Hide userBar when going to login/register pages
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
function gotoPage(page) {
    document.getElementById('pg-login').classList.add('hidden');
    document.getElementById('pg-register').classList.add('hidden');
    document.getElementById('pg-dash').classList.add('hidden');

    clearErrors();

    var allMsgs = ['login-err','reg-err','reg-ok','c-err','c-ok','t-err'];
    for (var m = 0; m < allMsgs.length; m++) hideMsg(allMsgs[m]);

    if (page === 'login') {
        document.getElementById('pg-login').classList.remove('hidden');
        document.getElementById('userBar').classList.add('hidden'); /* hide on login page */
    }
    if (page === 'register') {
        document.getElementById('pg-register').classList.remove('hidden');
        document.getElementById('userBar').classList.add('hidden'); /* hide on register page */
    }
    if (page === 'dash') {
        document.getElementById('pg-dash').classList.remove('hidden');
        document.getElementById('userBar').classList.remove('hidden');
    }
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   REGISTER
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
function doRegister() {
    clearErrors();
    hideMsg('reg-err');
    hideMsg('reg-ok');

    var username = document.getElementById('r-user').value.trim();
    var fullName = document.getElementById('r-name').value.trim();
    var email    = document.getElementById('r-email').value.trim();
    var phone    = document.getElementById('r-phone').value.trim();
    var password = document.getElementById('r-pass').value;
    var confirm  = document.getElementById('r-confirm').value;

    if (!username)           { markErr('r-user');    showErr('reg-err', 'âŒ Username is required.');                           return; }
    if (username.length < 4) { markErr('r-user');    showErr('reg-err', 'âŒ Username must be at least 4 characters long.');   return; }
    if (/\s/.test(username)) { markErr('r-user');    showErr('reg-err', 'âŒ Username cannot contain spaces.');                 return; }
    if (!fullName)           { markErr('r-name');    showErr('reg-err', 'âŒ Full name is required.');                          return; }
    if (!email)              { markErr('r-email');   showErr('reg-err', 'âŒ Email address is required.');                      return; }
    if (!/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(email)) { markErr('r-email'); showErr('reg-err', 'âŒ Enter a valid email (e.g. name@asti.edu.in).'); return; }
    if (!phone)              { markErr('r-phone');   showErr('reg-err', 'âŒ Phone number is required.');                       return; }
    var digits = phone.replace(/\D/g, '');
    if (digits.length < 7 || digits.length > 15) { markErr('r-phone'); showErr('reg-err', 'âŒ Enter a valid phone number (7â€“15 digits).'); return; }
    if (!password)           { markErr('r-pass');    showErr('reg-err', 'âŒ Password is required.');                           return; }
    if (password.length < 6) { markErr('r-pass');    showErr('reg-err', 'âŒ Password must be at least 6 characters long.');   return; }
    if (!confirm)            { markErr('r-confirm'); showErr('reg-err', 'âŒ Please confirm your password.');                   return; }
    if (password !== confirm) { markErr('r-confirm'); showErr('reg-err', 'âŒ Passwords do not match.');                        return; }

    var users = getUsers();
    for (var i = 0; i < users.length; i++) {
        if (users[i].username.toLowerCase() === username.toLowerCase()) {
            markErr('r-user'); showErr('reg-err', 'âŒ Username "' + esc(username) + '" is already taken.'); return;
        }
        if (users[i].email.toLowerCase() === email.toLowerCase()) {
            markErr('r-email'); showErr('reg-err', 'âŒ Email "' + esc(email) + '" is already registered.'); return;
        }
    }

    users.push({
        username: username, fullName: fullName,
        email: email, phone: phone,
        password: password, joinDate: new Date().toISOString()
    });
    setUsers(users);

    /* Clear register form */
    document.getElementById('r-user').value    = '';
    document.getElementById('r-name').value    = '';
    document.getElementById('r-email').value   = '';
    document.getElementById('r-phone').value   = '';
    document.getElementById('r-pass').value    = '';
    document.getElementById('r-confirm').value = '';
    resetPassField('r-pass',    'eye-reg');
    resetPassField('r-confirm', 'eye-conf');

    showOk('reg-ok', 'âœ… Account created! Redirecting to login...');
    setTimeout(function() {
        hideMsg('reg-ok');
        gotoPage('login');
        document.getElementById('l-user').value = username;
        document.getElementById('l-pass').focus();
    }, 2000);
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   LOGIN
   BUG FIX: Clear remember/saved-pass when unchecked
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
function doLogin() {
    clearErrors();
    hideMsg('login-err');

    var username = document.getElementById('l-user').value.trim();
    var password = document.getElementById('l-pass').value;
    var remember = document.getElementById('l-remember').checked;

    if (!username) { markErr('l-user'); showErr('login-err', 'âŒ Please enter your username.'); return; }
    if (!password) { markErr('l-pass'); showErr('login-err', 'âŒ Please enter your password.'); return; }

    var users = getUsers();
    var found  = null;
    for (var i = 0; i < users.length; i++) {
        if (users[i].username.toLowerCase() === username.toLowerCase()) { found = users[i]; break; }
    }

    if (!found) {
        markErr('l-user');
        showErr('login-err', 'âŒ No account found for "' + esc(username) + '". Please register first.');
        return;
    }
    if (found.password !== password) {
        markErr('l-pass');
        document.getElementById('l-pass').value = '';
        showErr('login-err', 'âŒ Incorrect password. Please try again.');
        return;
    }

    /* Handle Remember Me */
    if (remember) {
        setRemembered(found.username);
        setSavedPassword(found.password);
    } else {
        clearRemembered();
        clearSavedPassword();
    }

    resetPassField('l-pass', 'eye-login');

    CURRENT_USER = found;
    setSession(found);
    document.getElementById('l-user').value = '';
    document.getElementById('l-pass').value = '';
    openDashboard(found);
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   LOGOUT
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
function doLogout() {
    if (!confirm('Are you sure you want to logout?')) return;
    CURRENT_USER   = null;
    ALL_COMPLAINTS = [];
    TOAST_SHOWN_THIS_SESSION = false;
    clearSession();
    toastClose(false);
    gotoPage('login');
    /* Re-populate credentials if Remember Me is active */
    var rem = getRemembered();
    if (rem) {
        document.getElementById('l-user').value       = rem;
        document.getElementById('l-remember').checked = true;
        var savedPass = getSavedPassword();
        if (savedPass) {
            document.getElementById('l-pass').value = savedPass;
        } else {
            document.getElementById('l-pass').focus();
        }
    } else {
        document.getElementById('l-user').focus();
    }
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   OPEN DASHBOARD
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
function openDashboard(user) {
    CURRENT_USER = user;
    document.getElementById('userName').textContent  = user.fullName;
    document.getElementById('c-name').value  = user.fullName || '';
    document.getElementById('c-email').value = user.email    || '';
    gotoPage('dash');
    refreshAll();
    showSaveToast();
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   SUBMIT COMPLAINT
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
function doSubmitComplaint() {
    clearErrors();
    hideMsg('c-err');
    hideMsg('c-ok');

    if (!CURRENT_USER) { showErr('c-err', 'âŒ Session expired. Please login again.'); return; }

    var name  = document.getElementById('c-name').value.trim();
    var email = document.getElementById('c-email').value.trim();
    var roll  = document.getElementById('c-roll').value.trim();
    var dept  = document.getElementById('c-dept').value;
    var cat   = document.getElementById('c-cat').value;
    var desc  = document.getElementById('c-desc').value.trim();

    if (!name)  { markErr('c-name');  showErr('c-err', 'âŒ Full name is required.');             return; }
    if (!email) { markErr('c-email'); showErr('c-err', 'âŒ Email address is required.');          return; }
    if (!/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(email)) { markErr('c-email'); showErr('c-err', 'âŒ Enter a valid email address.'); return; }
    if (!roll)  { markErr('c-roll');  showErr('c-err', 'âŒ Roll No. / Employee ID is required.'); return; }
    if (!dept)  { markErr('c-dept');  showErr('c-err', 'âŒ Please select a department.');         return; }
    if (!cat)   { markErr('c-cat');   showErr('c-err', 'âŒ Please select a complaint category.'); return; }
    if (!desc)  { markErr('c-desc');  showErr('c-err', 'âŒ Please describe your complaint.');     return; }
    if (desc.length < 10) { markErr('c-desc'); showErr('c-err', 'âŒ Description too short (min. 10 characters).'); return; }

    var now      = new Date();
    var dateStr  = now.toLocaleDateString('en-IN', { year:'numeric', month:'short', day:'numeric' });
    var ticketId = 'CMP' + now.getFullYear() + String(Math.floor(Math.random() * 90000) + 10000);

    var complaint = {
        ticketId: ticketId, username: CURRENT_USER.username,
        name: name, email: email, rollNo: roll,
        department: dept, category: cat, description: desc,
        status: 'Pending', dateStr: dateStr, timestamp: now.toISOString(),
        statusHistory: [{ status: 'Pending', date: dateStr }]
    };

    var list = getComplaints();
    list.push(complaint);
    setComplaints(list);

    showOk('c-ok', 'âœ… Submitted! Ticket ID: ' + ticketId + '  â† Write this down to track your complaint.');

    document.getElementById('c-roll').value = '';
    document.getElementById('c-dept').value = '';
    document.getElementById('c-cat').value  = '';
    document.getElementById('c-desc').value = '';

    refreshAll();
    window.scrollTo({ top: 0, behavior: 'smooth' });
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   TRACK COMPLAINT
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
function doTrack() {
    clearErrors();
    hideMsg('t-err');
    document.getElementById('trackBox').style.display = 'none';

    var tid = document.getElementById('t-id').value.trim().toUpperCase();
    if (!tid) { markErr('t-id'); showErr('t-err', 'âŒ Please enter a Ticket ID.'); return; }

    var list  = getComplaints();
    var found = null;
    for (var i = 0; i < list.length; i++) {
        if (list[i].ticketId === tid) { found = list[i]; break; }
    }

    if (!found) {
        markErr('t-id');
        showErr('t-err', 'âŒ No complaint found for "' + esc(tid) + '". Please check the ID and try again.');
        return;
    }

    var badge = badgeClass(found.status);
    document.getElementById('tr-tid').textContent = found.ticketId;
    document.getElementById('tr-sts').innerHTML   = '<span class="' + badge + '">' + esc(found.status) + '</span>';
    document.getElementById('tr-cat').textContent = CAT_MAP[found.category]    || found.category;
    document.getElementById('tr-dep').textContent = DEPT_MAP[found.department] || found.department;
    document.getElementById('tr-dte').textContent = found.dateStr || found.date || 'â€”';
    document.getElementById('tr-dsc').textContent = found.description;

    document.getElementById('trackBox').style.display = 'block';
    document.getElementById('trackBox').scrollIntoView({ behavior: 'smooth', block: 'nearest' });
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   REFRESH ALL DASHBOARD PANELS
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
function refreshAll() {
    if (!CURRENT_USER) return;
    ALL_COMPLAINTS = getComplaints()
        .filter(function(c) { return c.username === CURRENT_USER.username; })
        .sort(function(a,b) { return new Date(b.timestamp) - new Date(a.timestamp); });
    updateStats();
    renderRecentList();
    renderHistoryTable(ALL_COMPLAINTS);
}

function updateStats() {
    document.getElementById('s-total').textContent = ALL_COMPLAINTS.length;
    document.getElementById('s-pend').textContent  = ALL_COMPLAINTS.filter(function(c){ return c.status === 'Pending'; }).length;
    document.getElementById('s-prog').textContent  = ALL_COMPLAINTS.filter(function(c){ return c.status === 'In Progress'; }).length;
    document.getElementById('s-resv').textContent  = ALL_COMPLAINTS.filter(function(c){ return c.status === 'Resolved'; }).length;
}

function renderRecentList() {
    var div  = document.getElementById('recentList');
    var show = ALL_COMPLAINTS.slice(0, 5);
    if (!show.length) { div.innerHTML = '<div class="empty-msg">No complaints filed yet.</div>'; return; }
    var html = '';
    for (var i = 0; i < show.length; i++) {
        var c       = show[i];
        var preview = esc(c.description.substring(0, 60)) + (c.description.length > 60 ? 'â€¦' : '');
        var badge   = badgeClass(c.status);
        html += '<div class="complaint-item">' +
                    '<h4>' + preview + '</h4>' +
                    '<p><strong>Ticket:</strong> '  + esc(c.ticketId) + '</p>' +
                    '<p><strong>Dept:</strong> '    + esc(DEPT_MAP[c.department] || c.department) + '</p>' +
                    '<p><strong>Date:</strong> '    + esc(c.dateStr || c.date) + '</p>' +
                    '<span class="' + badge + '">' + esc(c.status) + '</span>' +
                '</div>';
    }
    div.innerHTML = html;
}

function renderHistoryTable(list) {
    var tbody = document.getElementById('historyBody');
    var empty = document.getElementById('historyEmpty');
    if (!list.length) { tbody.innerHTML = ''; empty.classList.remove('hidden'); return; }
    empty.classList.add('hidden');
    var html = '';
    for (var i = 0; i < list.length; i++) {
        var c    = list[i];
        var hist = (c.statusHistory && c.statusHistory.length)
            ? c.statusHistory.slice()
            : [{ status: 'Pending', date: c.dateStr || c.date }];
        if (hist[hist.length - 1].status !== c.status) {
            hist.push({ status: c.status, date: c.dateStr || c.date });
        }
        var tl = '';
        for (var j = 0; j < hist.length; j++) {
            var hb = badgeClass(hist[j].status);
            if (j > 0) tl += '<span class="arr">â†’</span>';
            tl += '<span class="' + hb + '" style="font-size:0.73em;padding:3px 8px;" title="' + esc(hist[j].date) + '">' + esc(hist[j].status) + '</span>';
        }
        var cb = badgeClass(c.status);
        html += '<tr>' +
            '<td style="color:#9191b8;font-size:0.82em;">' + (i + 1) + '</td>' +
            '<td class="tid">' + esc(c.ticketId) + '</td>' +
            '<td>' + esc(CAT_MAP[c.category]    || c.category)    + '</td>' +
            '<td>' + esc(DEPT_MAP[c.department] || c.department)  + '</td>' +
            '<td style="white-space:nowrap;font-size:0.85em;">' + esc(c.dateStr || c.date) + '</td>' +
            '<td><div class="timeline">' + tl + '</div></td>' +
            '<td><span class="' + cb + '">' + esc(c.status) + '</span></td>' +
        '</tr>';
    }
    tbody.innerHTML = html;
}

function filterComplaints(filter, btn) {
    var btns = document.querySelectorAll('.btn-filter');
    for (var i = 0; i < btns.length; i++) btns[i].classList.remove('active');
    btn.classList.add('active');
    var filtered = (filter === 'all')
        ? ALL_COMPLAINTS
        : ALL_COMPLAINTS.filter(function(c) { return c.status === filter; });
    renderHistoryTable(filtered);
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   STARTUP â€” runs once on page load
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
(function init() {
    /* 1. Restore active session */
    var saved = getSession();
    if (saved && saved.username) {
        var users = getUsers();
        for (var i = 0; i < users.length; i++) {
            if (users[i].username === saved.username) {
                openDashboard(users[i]);
                return;
            }
        }
        clearSession(); /* user deleted â€” discard stale session */
    }
    /* 2. Pre-fill username + password if Remember Me was previously ticked */
    var rem = getRemembered();
    if (rem) {
        document.getElementById('l-user').value       = rem;
        document.getElementById('l-remember').checked = true;
        var savedPass = getSavedPassword();
        if (savedPass) {
            document.getElementById('l-pass').value = savedPass;
        } else {
            document.getElementById('l-pass').focus();
        }
    }
})();
</script>
</body>
</html>
